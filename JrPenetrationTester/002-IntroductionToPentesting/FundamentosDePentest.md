# Pentest
Um teste de penetração ou pentest é uma tentativa eticamente orientada de testar e analisar as defesas de segurança para proteger esses ativos e pedaços de informação. Um teste de penetração envolve usar as mesmas ferramentas, técnicas e metodologias que alguém com intenção maliciosa usaria e é semelhante a uma auditoria.

De acordo com a [Security Magazine](https://www.securitymagazine.com/articles/87787-hackers-attack-every-39-seconds) , uma revista do setor de segurança cibernética, ocorrem mais de 2.200 ataques cibernéticos todos os dias — 1 ataque a cada 39 segundos.

## Ética no Pentest
A ideia de obter acesso legal a um sistema de computador é um conceito desafiador de entender — afinal, o que o torna legal exatamente?

Pentest é uma **auditoria autorizada** da segurança e das defesas de um sistema de computador, conforme acordado pelos proprietários dos sistemas. A legalidade da penetração é bem clara nesse sentido; **qualquer coisa que fique fora desse acordo é considerada não autorizada**.

As empresas que fornecem serviços de teste de penetração são mantidas em relação a estruturas legais e acreditação da indústria. 
Por exemplo, o **National Cyber ​​Security Centre** (NCSC) tem o esquema de acreditação CHECK no Reino Unido. Esta verificação significa que apenas "*[CHECK] empresas aprovadas podem conduzir testes de penetração autorizados de sistemas e redes do setor público e CNI.*" (NCSC).

[
    Os testadores de penetração frequentemente se deparam com decisões moralmente questionáveis ​​durante um teste de penetração. 
    
    Por exemplo, eles estão obtendo acesso a um banco de dados e sendo apresentados a dados potencialmente sensíveis. Ou eles estão, talvez, realizando um ataque de phishing em um funcionário para testar a segurança humana de uma organização. Se essa ação foi acordada durante os estágios iniciais, ela é legal — porém eticamente questionável.
]

### HATs 
Os hackers são classificados em três chapéus, onde sua ética e motivações por trás de suas ações determinam em qual categoria de chapéu eles são colocados

| Categoria | Descrição | Exemplo |
| - | - | - |
| White Hat	| Esses hackers são considerados "pessoas boas". Eles permanecem dentro da lei e usam suas habilidades para beneficiar os outros.	| Por exemplo, um testador de penetração realizando um trabalho autorizado em uma empresa. |
| Grey Hat | Essas pessoas usam suas habilidades para beneficiar outras pessoas frequentemente; no entanto, elas não respeitam/seguem a lei ou os padrões éticos em todos os momentos.| Por exemplo, alguém derrubando um site fraudulento. |
| Black Hat | Essas pessoas são criminosas e muitas vezes buscam prejudicar organizações ou obter algum tipo de benefício financeiro às custas de outros.| Por exemplo, autores de ransomware infectam dispositivos com código malicioso e retêm dados para pedir resgate. |

### ROE - Rules of Engagement (Regras de Engajamento)
é um documento criado nos estágios iniciais de um compromisso de teste de penetração. Este documento consiste em três seções principais (explicadas na tabela abaixo), que são, em última análise, responsáveis ​​por decidir como o compromisso é realizado.

[Exemplo de ROE](https://sansorg.egnyte.com/dl/bF4I3yCcnt/?)


| Seção | Descrição |
| - | - |
| Permissão | Esta seção do documento dá permissão explícita para que o engajamento seja realizado. Esta permissão é essencial para proteger legalmente indivíduos e organizações para as atividades que realizam. |
| Escopo do teste | Esta seção do documento anotará alvos específicos aos quais o engajamento deve ser aplicado. Por exemplo, o teste de penetração pode ser aplicado somente a certos servidores ou aplicativos, mas não à rede inteira. |
| Regras | A seção de regras definirá exatamente as técnicas que são permitidas durante o engajamento. Por exemplo, as regras podem declarar especificamente que técnicas como ataques de phishing são proibidas, mas ataques MITM (Man-in-the-Middle) são aceitáveis. |
---

## Metodologias de Pentest
Os passos que um testador de penetração toma durante um engajamento são conhecidos como metodologia.

### Estágios

| Estagio | Descrição |
| - | - |
| Coleta de informações | Esta etapa envolve coletar o máximo possível de informações publicamente acessíveis sobre um alvo/organização, por exemplo, OSINT e pesquisa. **Observação: isso não envolve a varredura de nenhum sistema** |
| Enumeração/Digitalização | Este estágio envolve descobrir aplicativos e serviços em execução nos sistemas. Por exemplo, encontrar um servidor web que pode ser potencialmente vulnerável |
| Exploração | Este estágio envolve alavancar vulnerabilidades descobertas em um sistema ou aplicativo. Este estágio pode envolver o uso de exploits públicos ou explorar lógica de aplicativo. |
| Escalação de privilégios | Depois de explorar com sucesso um sistema ou aplicativo (conhecido como foothold), este estágio é a tentativa de expandir seu acesso a um sistema. Você pode escalar horizontalmente e verticalmente, onde horizontalmente é acessar outra conta do mesmo grupo de permissão (ou seja, outro usuário), enquanto verticalmente é a de outro grupo de permissão (ou seja, um administrador). |
| Pós-exploração | sta etapa envolve algumas subetapas: 1. Quais outros hosts podem ser alvos (pivotamento) / 2. Que informações adicionais podemos coletar do host agora que somos um usuário privilegiado / 3.  Cobrindo seus rastros / 4. Relatórios |

### OSSTMM - The Open Source Security Testing Methodology Manual (O Manual de Metodologia de Testes de Segurança de Código Aberto)
O [Manual de Metodologia de Testes de Segurança de Código Aberto](https://github.com/mtesauro/owasp-wte/blob/master/temp-projects/wte-docs/contents/usr/share/doc/WTE-Documentation/OSSTMM/OSSTMM.3.pdf) fornece uma estrutura detalhada de estratégias de teste para sistemas, software, aplicativos, comunicações e o aspecto humano da segurança cibernética.

A metodologia se concentra principalmente em como esses sistemas e aplicativos se comunicam, por isso inclui uma metodologia para:
- Telecomunicações (telefones, VoIP, etc.)
- Redes com fio
- Comunicações sem fio

| Vantagens | Desvantagens |
| - | - |
| Aborda diversas estratégias de teste em detalhes | A estrutura é difícil de entender, muito detalhada e tende a usar definições únicas. |
| Inclui estratégias de teste para alvos específicos (ou seja, telecomunicações e redes) |  |
| A estrutura é flexível dependendo das necessidades da organização |  |
| A estrutura visa definir um padrão para sistemas e aplicativos, o que significa que uma metodologia universal pode ser usada em um cenário de teste de penetração. |  |

### OWASP (Open Web Application Security Project)
A estrutura " [Open Web Application Security Project](https://owasp.org/) " é uma estrutura frequentemente atualizada e conduzida pela comunidade, usada exclusivamente para testar a segurança de aplicativos e serviços da web.

A fundação  escreve regularmente relatórios  informando as dez principais vulnerabilidades de segurança que um aplicativo web pode ter, a abordagem de teste e a correção.

| Vantagens | Desvantagens |
| - | - |
| Fácil de entender e assimilar | Pode não estar claro que tipo de vulnerabilidade um aplicativo web tem (elas podem frequentemente se sobrepor) |
| Mantido ativamente e atualizado com frequência | O OWASP não faz sugestões para nenhum ciclo de vida específico de desenvolvimento de software |
| Ele abrange todos os estágios de um envolvimento: do teste ao relatório e correção | A estrutura não possui nenhuma acreditação como a CHECK |
| Especializada em aplicativos e serviços web |  |

### NIST Cybersecurity Framework 1.1
É um [framework](https://www.nist.gov/cyberframework) popular usado para melhorar os padrões de segurança cibernética de uma organização e gerenciar o risco de ameaças cibernéticas. Este framework é uma menção honrosa por causa de sua popularidade e detalhes.

A estrutura fornece diretrizes sobre controles de segurança e benchmarks para o sucesso de organizações de infraestrutura crítica (usinas de energia, etc.) até comerciais. Há uma seção limitada sobre uma diretriz padrão para a metodologia que um testador de penetração deve adotar.

| Vantagens | Desvantagens |
| - | - |
| Estima-se que o NIST Framework seja usado por 50% das organizações americanas até 2020 | O NIST tem muitas iterações de estruturas, então pode ser difícil decidir qual delas se aplica à sua organização |
| A estrutura é extremamente detalhada ao definir padrões para ajudar organizações a mitigar a ameaça representada por ameaças cibernéticas | A estrutura do NIST tem políticas de auditoria fracas, dificultando determinar como uma violação ocorreu |
| A estrutura é atualizada com muita frequência | A estrutura não considera a computação em nuvem, que está se tornando cada vez mais popular entre as organizações |
| O NIST fornece acreditação para organizações que usam essa estrutura |  |
| A estrutura do NIST foi projetada para ser implementada junto com outras estruturas |  |

### NCSC CAF
O [Cyber ​​Assessment Framework (CAF)](https://www.ncsc.gov.uk/collection/cyber-assessment-framework/caf-objective-a-managing-security-risk) é uma estrutura abrangente de quatorze princípios usados ​​para avaliar o risco de várias ameaças cibernéticas e as defesas de uma organização contra elas.

A estrutura se aplica a organizações consideradas como realizando "serviços e atividades de importância vital", como infraestrutura crítica, serviços bancários e similares. A estrutura foca e avalia principalmente os seguintes tópicos:
- Segurança de dados
- Segurança do sistema
- Identidade e controle de acesso
- Resiliencia
- Monitoramento
- Planejamento de resposta e recuperação

| Vantagens | Desvantagens |
| - | - |
| Esta estrutura é apoiada por uma agência governamental de segurança cibernética | A estrutura ainda é nova no setor, o que significa que as organizações não tiveram muito tempo para fazer as mudanças necessárias para se adequarem a ela |
| Esta estrutura fornece acreditação | A estrutura é baseada em princípios e ideias e não é tão direta quanto ter regras como algumas outras estruturas |
| Esta estrutura abrange quatorze princípios que abrangem desde a segurança até a resposta |  |

## Black box, White box, Grey box Penetration Testing